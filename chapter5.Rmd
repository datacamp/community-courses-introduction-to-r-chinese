--- 
title_meta  : 第五章
title       : 資料框
description : 實務上你面對的多數資料集都是儲存為資料框的格式，學完本章節之後，你將可以建立資料框、選擇資料框中有興趣的部分以及根據某一個變數排序資料框。

--- type:NormalExercise xp:100 skills:1 key:697536131763a67337978935d895a05e2ed6bfee
## 資料框是什麼？

矩陣中所有的元素都應該是相同類型的，記得你在前一個章節中建立的星際大戰票房矩陣嗎？矩陣裡面的元素全部都是數值。

當你做市場調查時，問卷中常常有問題像是：
- 請問你結婚了嗎？回答為是/否的問題(`邏輯`)
- 請問你的年紀為？(`數值`)
- 對於本產品的意見？或其他開放式問題(`字元`)
- ...

因此問卷的調查結果通常包含了不同類型的資料。 

資料框中將觀測值儲存為列，將變數儲存為欄，這與其他統計軟體像是SAS或SPSS的概念是相似的。

*** =instructions
按下'Submit Answer'。將內建的範例資料框[`mtcars`](http://www.rdocumentation.org/packages/datasets/functions/mtcars)印出在R Console中。

*** =hint
按下'Submit Answer'並觀察結果！

*** =pre_exercise_code
```{r}
# no pec
```

*** =sample_code
```{r}
# 印出內建的R資料框
mtcars 
```

*** =solution
```{r}
# 印出內建的R資料框
mtcars 
```

*** =sct
```{r}
test_output_contains("mtcars", incorrect_msg = "不需要更改任何程式，確定你有將 `mtcars` 印出。")
success_msg("太棒了，前進下一個練習！")
```


--- type:NormalExercise xp:100 skills:1 key:c3f245836ce0b7473355c0278265f0b16f18a4b7
## 很快地看看資料集

哇，真的有很多車！ 

你常常需要分析龐大的資料集，這時候你的第一件事應該是對資料結構與主要元素有清晰的認知，先觀察小部份的資料集是很有用的。

在R中可以使用[`head()`](http://www.rdocumentation.org/packages/utils/functions/head)函數幫助你呈現資料框的前幾個觀測值，相同地，[`tail()`](http://www.rdocumentation.org/packages/utils/functions/head)函數可以印出資料框的最後幾個觀測值。

[`head()`](http://www.rdocumentation.org/packages/utils/functions/head)與[`tail()`](http://www.rdocumentation.org/packages/utils/functions/head)函數都會將欄位的名稱印出。

*** =instructions
對[`mtcars`](http://www.rdocumentation.org/packages/datasets/functions/mtcars)資料框使用[`head()`](http://www.rdocumentation.org/packages/utils/functions/head)函數來看看它的欄位名稱與前幾列觀測值。

*** =hint
`head(mtcars)` 會將 `mtcars` 的前幾列印出。

*** =pre_exercise_code
```{r}
# no pec
```

*** =sample_code
```{r}
# 對mtcars呼叫head()

```

*** =solution
```{r}
# 對mtcars呼叫head()
head(mtcars)
```

*** =sct
```{r}
test_function("head", "x", incorrect_msg = "確認是否有對 `mtcars` 使用 `head()` 函數？")
test_output_contains("head(mtcars)", incorrect_msg = "只需要將呼叫 `head()` 的結果印出即可，不需要指派新變數。")
success_msg("太棒了，讓我們看看資料集中有什麼資料，例如 `hp` 代表車子的馬力，Datsun在呈現出來的6輛車子中是馬力最低的那輛，在R Console輸入 `?mtcars` 可以閱讀詳細的變數定義與類型，前進下一個練習！");
```


--- type:NormalExercise xp:100 skills:1 key:44c05f378266cbc25079ec804787fdc09e111aa0
## 觀察一下結構

還有另外一種常用的方式可以幫助你快速地瞭解資料概觀，那就是使用[`str()`](http://www.rdocumentation.org/packages/utils/functions/str)函數，[`str()`](http://www.rdocumentation.org/packages/utils/functions/str)函數顯示資料集的結構，告訴你資料框的資訊有：

- 觀測值總計(32種車型)
- 變數總計(11種車輛資訊)
- 變數名稱清單(`mpg`, `cyl` ... )
- 變數的資料類型(`數值`)
- 前幾個觀測值

當你拿到一個新資料集或資料框，在你開始做分析之前通常會使用[`str()`](http://www.rdocumentation.org/packages/utils/functions/str)函數了解資料的樣態。

*** =instructions
Investigate the structure of [`mtcars`](http://www.rdocumentation.org/packages/datasets/functions/mtcars). Make sure that you see the same numbers, variables and data types as mentioned above.

*** =hint
Use the [`str()`](http://www.rdocumentation.org/packages/utils/functions/str) function on [`mtcars`](http://www.rdocumentation.org/packages/datasets/functions/mtcars).

*** =pre_exercise_code
```{r}
# no pec
```

*** =sample_code
```{r}
# Investigate the structure of mtcars
```

*** =solution
```{r}
# Investigate the structure of mtcars
str(mtcars)
```

*** =sct
```{r}
test_output_contains("str(mtcars)", incorrect_msg = "Have you correctly called `str()` on `mtcars`?")
success_msg("Nice work! Can you find all the information that is listed in the exercise's assignment? Continue to the next exercise.")
```


--- type:NormalExercise xp:100 skills:1 key:1599e175505f5980064369d4fea9b77ce1574b4e
## Creating a data frame 

Since using built-in data sets is not even half the fun of creating your own data sets, the rest of this chapter is based on your personally developed data set. Put your jet pack on because it is time for some space exploration! 

As a first goal, you want to construct a data frame that describes the main characteristics of eight planets in our solar system. According to your good friend Buzz, the main features of a planet are:

- The type of planet (Terrestrial or Gas Giant).
- The planet's diameter relative to the diameter of the Earth.
- The planet's rotation across the sun relative to that of the Earth.
- If the planet has rings or not (TRUE or FALSE).

After doing some high-quality research on [Wikipedia](http://en.wikipedia.org/wiki/Planet), you feel confident enough to create the necessary vectors: `name`, `type`, `diameter`, `rotation` and `rings`; these vectors have already been coded up on the right. The first element in each of these vectors correspond to the first observation.

You construct a data frame with the [`data.frame()`](http://www.rdocumentation.org/packages/base/functions/data.frame) function. As arguments, you pass the vectors from before: they will become the different columns of your data frame. Because every column has the same length, the vectors you pass should also have the same length. But don't forget that it is possible (and likely) that they contain different types of data.

*** =instructions
Use the function [`data.frame()`](http://www.rdocumentation.org/packages/base/functions/data.frame) to construct a data frame. Pass the vectors `name`, `type`, `diameter`, `rotation` and `rings` as arguments to `data.frame()`, in this order. Call the resulting data frame `planets_df`.

*** =hint
Your `data.frame()` call starts as follows:
```
data.frame(planets, type, diameter)
```
Can you finish it?

*** =pre_exercise_code
```{r}
# no pec
```

*** =sample_code
```{r}
# Definition of vectors
name <- c("Mercury", "Venus", "Earth", "Mars", "Jupiter", "Saturn", "Uranus", "Neptune")
type <- c("Terrestrial planet", "Terrestrial planet", "Terrestrial planet", 
          "Terrestrial planet", "Gas giant", "Gas giant", "Gas giant", "Gas giant")
diameter <- c(0.382, 0.949, 1, 0.532, 11.209, 9.449, 4.007, 3.883)
rotation <- c(58.64, -243.02, 1, 1.03, 0.41, 0.43, -0.72, 0.67)
rings <- c(FALSE, FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE)

# Create a data frame from the vectors
planets_df <-

```

*** =solution
```{r}
# Definition of vectors
name <- c("Mercury", "Venus", "Earth", "Mars", "Jupiter", "Saturn", "Uranus", "Neptune")
type <- c("Terrestrial planet", "Terrestrial planet", "Terrestrial planet", 
          "Terrestrial planet", "Gas giant", "Gas giant", "Gas giant", "Gas giant")
diameter <- c(0.382, 0.949, 1, 0.532, 11.209, 9.449, 4.007, 3.883)
rotation <- c(58.64, -243.02, 1, 1.03, 0.41, 0.43, -0.72, 0.67)
rings <- c(FALSE, FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE)

# Create a data frame from the vectors
planets_df <- data.frame(name, type, diameter, rotation, rings)
```

*** =sct
```{r}
msg = "Do not change anything about the definition of the vectors. Only add a `data.frame()` call to create `planets_df`."
test_object("name", undefined_msg = msg, incorrect_msg = msg)
test_object("type", undefined_msg = msg, incorrect_msg = msg)
test_object("diameter", undefined_msg = msg, incorrect_msg = msg)
test_object("rotation", undefined_msg = msg, incorrect_msg = msg)
test_object("rings", undefined_msg = msg, incorrect_msg = msg)

test_object("planets_df",
            incorrect_msg = "Have you correctly called `data.frame()` to create `planets_df`. Inside `data.frame()`, make sure to pass all vectors in the correct order: `name`, `type`, `diameter`, `rotation` and finally `rings`.")

success_msg("Great job! Continue to the next exercise. The logical next step, as you know by now, is inspecting the data frame you just created. Head over to the next exercise.");
```


--- type:NormalExercise xp:100 skills:1 key:72d24b916b842527b40bd19ff3093b823980c234
## Creating a data frame (2)

The `planets_df` data frame should have 8 observations and 5 variables. It has been made available in the workspace, so you can directly use it.

*** =instructions
Use [`str()`](http://www.rdocumentation.org/packages/utils/functions/str) to investigate the structure of the new `planets_df` variable.

*** =hint
`planets_df` is already available in your workspace, so `str(planets_df)` will do the trick.

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
```

*** =sample_code
```{r}
# Check the structure of planets_df
```

*** =solution
```{r}
# Check the structure of planets_df
str(planets_df)
```

*** =sct
```{r}
msg = "Do not remove or overwrite the `planets_df` data frame that is already available in the workspace!"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_output_contains("str(planets_df)", incorrect_msg = "Have you correctly displayed the structure of `planets_df`? Use `str()` to do this!")
success_msg("Awesome! Now that you have a clear understanding of the `planets_df` data set, it's time to see how you can select elements from it. Learn all about in the next exercises!")
```


--- type:NormalExercise xp:100 skills:1 key:a6eeec0beaa5b270c1e9fd1fd4bf285ac5363e1a
## Selection of data frame elements

Similar to vectors and matrices, you select elements from a data frame with the help of square brackets `[ ]`. By using a comma, you can indicate what to select from the rows and the columns respectively. For example:

- `my_df[1,2]` selects the value at the first row and select element in `my_df`.
- `my_df[1:3,2:4]` selects rows 1, 2, 3 and columns 2, 3, 4 in `my_df`.

Sometimes you want to select all elements of a row or column. For example, `my_df[1, ]` selects all elements of the first row. Let us now apply this technique on `planets_df`!

*** =instructions
- From `planets_df`, select the diameter of Mercury: this is the value at the first row and the third column. Simply print out the result.
- From `planets_df`, select all data on Mars (the fourth row). Simply print out the result.

*** =hint
To select the diameter for Venus (the second row), you would need: `planets_df[2,3]`. What do you need for Mercury then?

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
```

*** =sample_code
```{r}
# The planets_df data frame from the previous exercise is pre-loaded

# Print out diameter of of Mercury (row 1, column 3)


# Print out data for Mars (entire fourth row)

```

*** =solution
```{r}
# The planets_df data frame from the previous exercise is pre-loaded

# Print out diameter of of Mercury (row 1, column 3)
planets_df[1,3]

# Print out data for Mars (entire fourth row)
planets_df[4, ]
```

*** =sct
```{r}
msg = "Do not remove or overwrite the `planets_df` data frame!"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_output_contains("planets_df[1,3]", incorrect_msg = "Have you correctly selected and printed out the diameter for Mercury? You can use `[1,3]`.")
test_output_contains("planets_df[4, ]", incorrect_msg = "Have you correctly selected and printed out all data for Mars? You can use `[4,]`.")
success_msg("Great! Apart from selecting elements from your data frame by index, you can also use the column names. To learn how, head over to the next exercise.")
```


--- type:NormalExercise xp:100 skills:1 key:1b1be7e1473994d9d6762816f15ea282787be250
## Selection of data frame elements (2)

Instead of using numerics to select elements of a data frame, you can also use the variable names to select columns of a data frame. 

Suppose you want to select the first three elements of the `type` column. One way to do this is

```
planets_df[1:3,1]
```

A possible disadvantage of this approach is that you have to know (or look up) the column number of `type`, which gets hard if you have a lot of variables. It is often easier to just make use of the variable name:

```
planets_df[1:3,"type"]
```

*** =instructions
Select and print out the first 5 values in the `"diameter"` column of `planets_df`.

*** =hint
You can select the first five values with `planets_df[1:5, ...]`. Can you fill in the `...` bit to only select the `"diameter"` column?

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
```

*** =sample_code
```{r}
# The planets_df data frame from the previous exercise is pre-loaded

# Select first 5 values of diameter column

```

*** =solution
```{r}
# The planets_df data frame from the previous exercise is pre-loaded

# Select first 5 values of diameter column
planets_df[1:5, "diameter"]
```

*** =sct
```{r}
msg = "Do not remove or overwrite the `planets_df` data frame!"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_output_contains("planets_df[1:5, \"diameter\"]", incorrect_msg = "Have you correctly selected the first five values from the diameter column and printed them out? You can use `[1:5, \"diameter\"]` here.")
success_msg("Nice! Continue to the next exercise!")
```


--- type:NormalExercise xp:100 skills:1 key:c332cd7e7e46daa391edea8aea961414c8c8d0ce
## Only planets with rings

You will often want to select an entire column, namely one specific variable from a data frame. If you want to select all elements of the variable `diameter`, for example, both of these will do the trick:

```
planets_df[,3]
planets_df[,"diameter"]
```

However, there is a short-cut. If your columns have names, you can use the `$` sign:

```
planets_df$diameter
```

*** =instructions
- Use the `$` sign to select the `rings` variable from `planets_df`. Store the vector that results as `rings_vector`.
- Print out `rings_vector` to see if you got it right.

*** =hint
`planets_df$diameter` selects the `diameter` column from `planets_df`; what do you need to select the `rings` column then?

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
```

*** =sample_code
```{r}
# planets_df is pre-loaded in your workspace

# Select the rings variable from planets_df
rings_vector <- 
  
# Print out rings_vector
```

*** =solution
```{r}
# planets_df is pre-loaded in your workspace

# Select the rings variable from planets_df
rings_vector <- planets_df$rings

# Print out rings_vector
rings_vector
```

*** =sct
```{r}
msg = "Do not remove or overwrite the `planets_df` data frame!"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_object("rings_vector",
            incorrect_msg = "Have you correctly selected the `rings` variable from `planets_df`? Use `$rings`. Store the result as `rings_vector`.")
test_output_contains("rings_vector", incorrect_msg = "Don't forget to print out `rings_vector` after you've created it!")
success_msg("Great! Continue to the next exercise and discover yet another way of subsetting!")
```


--- type:NormalExercise xp:100 skills:1 key:0aa1fd7d080afe1bb1031562e8004121943632c6
## Only planets with rings (2)

You probably remember from high school that some planets in our solar system have rings and others do not. But due to other priorities at that time (read: puberty) you can not recall their names, let alone their rotation speed, etc. 

Could R help you out?

If you type `rings_vector` in the console, you get:

```
[1] FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE
```

This means that the first four observations (or planets) do not have a ring (`FALSE`), but the other four do (`TRUE`). However, you do not get a nice overview of the names of these planets, their diameter, etc. Let's try to use `rings_vector` to select the data for the four planets with rings. 

*** =instructions
The code on the right selects the `name` column of all planets that have rings. Adapt the code so that instead of only the `name` column, _all_ columns for planets that have rings are selected.

*** =hint
Remember that to select _all_ columns, you simply have to leave the columns part inside the `[ ]` empty! This means you'll need `[rings_vector, ]`.

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
rings_vector <- planets_df$rings
```

*** =sample_code
```{r}
# planets_df and rings_vector are pre-loaded in your workspace

# Adapt the code to select all columns for planets with rings
planets_df[rings_vector, "name"]
```

*** =solution
```{r}
# planets_df and rings_vector are pre-loaded in your workspace

# Adapt the code to select all columns for planets with rings
planets_df[rings_vector, ]
```

*** =sct
```{r}
msg <- "Do not remove or overwrite `planets_df` or `rings_vector`!"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_object("rings_vector", undefined_msg = msg, incorrect_msg = msg)
test_output_contains('planets_df[rings_vector, ]', incorrect_msg = "Have you correctly adapted the code to select _all_ columns for the planets that have rings? You can use `planets_df[rings_vector, ]`. Make sure to include the comma here, it's crucial!")
success_msg("Wonderful! This is a rather tedious solution. The next exercise will teach you how to do it in a more concise way.")
```


--- type:NormalExercise xp:100 skills:1 key:9b873ed27e9df18a217699041950ecd20691eaf1
## Only planets with rings but shorter

So what exactly did you learn in the previous exercises? You selected a subset from a data frame (`planets_df`) based on whether or not a certain condition was true (rings or no rings), and you managed to pull out all relevant data. Pretty awesome! By now, NASA is probably already flirting with your CV ;-). 

Now, let us move up one level and use the function [`subset()`](http://www.rdocumentation.org/packages/base/functions/subset). You should see the [`subset()`](http://www.rdocumentation.org/packages/base/functions/subset) function as a short-cut to do exactly the same as what you did in the previous exercises. 

```
subset(my_df, subset = some_condition)
``` 

The first argument of [`subset()`](http://www.rdocumentation.org/packages/base/functions/subset) specifies the data set for which you want a subset. By adding the second argument, you give R the necessary information and conditions to select the correct subset. 

The code below will give the exact same result as you got in the previous exercise, but this time, you didn't need the `rings_vector`!

```
subset(planets_df, subset = rings)
``` 

*** =instructions
Use `subset()` on `planets_df` to select planets that have a diameter smaller than Earth. Because the `diameter` variable is a relative measure of the planet's diameter w.r.t that of planet Earth, your condition is `diameter < 1`.

*** =hint
`subset(planets_df, subset = ...)` almost solves it; can you fill in the `...`?

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
```

*** =sample_code
```{r}
# planets_df is pre-loaded in your workspace

# Select planets with diameter < 1

```

*** =solution
```{r}
# planets_df is pre-loaded in your workspace

# Select planets with diameter < 1
subset(planets_df, subset = diameter < 1)
```

*** =sct
```{r}
msg = "Do not remove or overwrite the `planets_df` data frame!"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_correct({
  test_output_contains("subset(planets_df, subset = diameter < 1)", incorrect_msg = "Have you correctly specified the `subset = ...` part inside `subset()`. The condition in this case is `diameter < 1`. Simply print out the result.")  
}, {
  test_function("subset", args = "x", 
                not_called_msg = "Make sure to use the `subset()` function to perform the selection!",
                incorrect_msg = "The first argument you pass to `subset()` should be `planets_df`.")
})
success_msg("Great! Not only is the `subset()` function more concise, it is probably also more understandable for people who read your code. Continue to the next exercise.");
```


--- type:NormalExercise xp:100 skills:1 key:2397d0f7cdf728961c9f5b8208c3b2694e20e2df
## Sorting

Making and creating rankings is one of mankind's favorite affairs. These rankings can be useful (best universities in the world), entertaining (most influential movie stars) or pointless (best 007 look-a-like).

In data analysis you can sort your data according to a certain variable in the data set. In R, this is done with the help of the function [`order()`](http://www.rdocumentation.org/packages/base/functions/order). 

[`order()`](http://www.rdocumentation.org/packages/base/functions/order) is a function that gives you the ranked position of each element when it is applied on a variable, such as a vector for example:

```
> a <- c(100, 10, 1000)
> order(a)
[1] 2 1 3
```

10, which is the second element in `a`, is the smallest elements, so 2 comes first in the output of `order(a)`. 100, which is the first element in `a` is the second smallest element, so 1 comes second in the output of `order(a)`.

This means we can use the output of `order(a)` to reshuffle `a`:
    
```
> a[order(a)]
[1]   10  100 1000
``` 

*** =instructions
Experiment with the [`order()`](http://www.rdocumentation.org/packages/base/functions/order) function in the console. Click 'Submit Answer' when you are ready to continue.

*** =hint
Just play with the [`order()`](http://www.rdocumentation.org/packages/base/functions/order) function in the console!

*** =pre_exercise_code
```{r}
# no pec
```

*** =sample_code
```{r}
# Play around with the order function in the console
```

*** =solution
```{r}
# Play around with the order function in the console
```

*** =sct
```{r}
success_msg("Great! Now let's use the `order()` function to sort your data frame!")
```


--- type:NormalExercise xp:100 skills:1 key:81baabbbb256ac67de6d584ee37cfa218566f54a
## Sorting your data frame

Alright, now that you understand the [`order()`](http://www.rdocumentation.org/packages/base/functions/order) function, let us do something useful with it. You would like to rearrange your data frame such that it starts with the smallest planet and ends with the largest one. A sort on the `diameter` column.

*** =instructions
- Call `order()` on `planets_df$diameter` (the `diameter` column of `planets_df`). Store the result as `positions`.
- Now reshuffle `planets_df` with the `positions` vector as row indexes inside square brackets. Keep all columns. Simply print out the result.

*** =hint
- Use `order(planets_df$diameter)` to create `positions`.
- Now, you can use `positions` inside square brackets: `planets_df[...]`; can you fill in the `...`?

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
```

*** =sample_code
```{r}
# planets_df is pre-loaded in your workspace

# Use order() to create positions
positions <-  

# Use positions to sort planets_df

```

*** =solution
```{r}
# planets_df is pre-loaded in your workspace

# Use order() to create positions
positions <- order(planets_df$diameter)

# Use positions to sort planets_df
planets_df[positions, ]
```

*** =sct
```{r}
msg = "Do not remove or overwrite the `planets_df` data frame!"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_object("positions",
            incorrect_msg = "Have you correctly calculated the `positions` variable? You can use `sort(planets_df$diameter)`.")
test_output_contains("planets_df[positions,]",
                     incorrect_msg = "Use `planets_df[positions, ]` to sort `planets_df`; the comma inside the square brackets is crucial!")
success_msg("Wonderful! This exercise concludes the chapter on data frames. Remember that data frames are extremely important in R, you will need them all the time. Another very often used data structure is the list. This will be the subject of the next chapter!")
```


