--- 
title_meta  : 第五章
title       : 資料框
description : 實務上你面對的多數資料集都是儲存為資料框的格式，學完本章節之後，你將可以建立資料框、選擇資料框中有興趣的部分以及根據某一個變數排序資料框。

--- type:NormalExercise xp:100 skills:1 key:697536131763a67337978935d895a05e2ed6bfee
## 資料框是什麼？

矩陣中所有的元素都應該是相同類型的，記得你在前一個章節中建立的星際大戰票房矩陣嗎？矩陣裡面的元素全部都是數值。

當你做市場調查時，問卷中常常有問題像是：
- 請問你結婚了嗎？回答為是/否的問題(`邏輯`)
- 請問你的年紀為？(`數值`)
- 對於本產品的意見？或其他開放式問題(`字元`)
- ...

因此問卷的調查結果通常包含了不同類型的資料。 

資料框中將觀測值儲存為列，將變數儲存為欄，這與其他統計軟體像是SAS或SPSS的概念是相似的。

*** =instructions
按下'Submit Answer'。將內建的範例資料框[`mtcars`](http://www.rdocumentation.org/packages/datasets/functions/mtcars)印出在R Console中。

*** =hint
按下'Submit Answer'並觀察結果！

*** =pre_exercise_code
```{r}
# no pec
```

*** =sample_code
```{r}
# 印出內建的R資料框
mtcars 
```

*** =solution
```{r}
# 印出內建的R資料框
mtcars 
```

*** =sct
```{r}
test_output_contains("mtcars", incorrect_msg = "不需要更改任何程式，確定你有將 `mtcars` 印出。")
success_msg("太棒了，前進下一個練習！")
```


--- type:NormalExercise xp:100 skills:1 key:c3f245836ce0b7473355c0278265f0b16f18a4b7
## 很快地看看資料集

哇，真的有很多車！ 

你常常需要分析龐大的資料集，這時候你的第一件事應該是對資料結構與主要元素有清晰的認知，先觀察小部份的資料集是很有用的。

在R中可以使用[`head()`](http://www.rdocumentation.org/packages/utils/functions/head)函數幫助你呈現資料框的前幾個觀測值，相同地，[`tail()`](http://www.rdocumentation.org/packages/utils/functions/head)函數可以印出資料框的最後幾個觀測值。

[`head()`](http://www.rdocumentation.org/packages/utils/functions/head)與[`tail()`](http://www.rdocumentation.org/packages/utils/functions/head)函數都會將欄位的名稱印出。

*** =instructions
對[`mtcars`](http://www.rdocumentation.org/packages/datasets/functions/mtcars)資料框使用[`head()`](http://www.rdocumentation.org/packages/utils/functions/head)函數來看看它的欄位名稱與前幾列觀測值。

*** =hint
`head(mtcars)` 會將 `mtcars` 的前幾列印出。

*** =pre_exercise_code
```{r}
# no pec
```

*** =sample_code
```{r}
# 對mtcars呼叫head()

```

*** =solution
```{r}
# 對mtcars呼叫head()
head(mtcars)
```

*** =sct
```{r}
test_function("head", "x", incorrect_msg = "確認是否有對 `mtcars` 使用 `head()` 函數？")
test_output_contains("head(mtcars)", incorrect_msg = "只需要將呼叫 `head()` 的結果印出即可，不需要指派新變數。")
success_msg("太棒了，讓我們看看資料集中有什麼資料，例如 `hp` 代表車子的馬力，Datsun在呈現出來的6輛車子中是馬力最低的那輛，在R Console輸入 `?mtcars` 可以閱讀詳細的變數定義與類型，前進下一個練習！");
```


--- type:NormalExercise xp:100 skills:1 key:44c05f378266cbc25079ec804787fdc09e111aa0
## 觀察一下結構

還有另外一種常用的方式可以幫助你快速地瞭解資料概觀，那就是使用[`str()`](http://www.rdocumentation.org/packages/utils/functions/str)函數，[`str()`](http://www.rdocumentation.org/packages/utils/functions/str)函數顯示資料集的結構，告訴你資料框的資訊有：

- 觀測值總計(32種車型)
- 變數總計(11種車輛資訊)
- 變數名稱清單(`mpg`, `cyl` ... )
- 變數的資料類型(`數值`)
- 前幾個觀測值

當你拿到一個新資料集或資料框，在你開始做分析之前通常會使用[`str()`](http://www.rdocumentation.org/packages/utils/functions/str)函數了解資料的樣態。

*** =instructions
觀察[`mtcars`](http://www.rdocumentation.org/packages/datasets/functions/mtcars)的結構，並確定你有觀察到跟前述相同的觀測值個數、變數總計與資料類別。

*** =hint
對[`mtcars`](http://www.rdocumentation.org/packages/datasets/functions/mtcars)使用[`str()`](http://www.rdocumentation.org/packages/utils/functions/str)函數。

*** =pre_exercise_code
```{r}
# no pec
```

*** =sample_code
```{r}
# 查看mtcars的結構
```

*** =solution
```{r}
# 查看mtcars的結構
str(mtcars)
```

*** =sct
```{r}
test_output_contains("str(mtcars)", incorrect_msg = "確認是否有對 `mtcars` 使用 `str()`？")
success_msg("做得好，你看到了說明中的資訊嗎？前進下一個練習！")
```


--- type:NormalExercise xp:100 skills:1 key:1599e175505f5980064369d4fea9b77ce1574b4e
## 建立一個資料框 

用內建的資料集一點都不有趣對吧！接下來的練習我們要使用你自己建立的資料框，讓我們穿上太空衣，做一點星際探索吧！

首先我們來建立一個描述太陽系八個行星特性的資料框，根據你的好友Buzz的說法，星球的主要特性有：

- 星球種類(陸地或氣體)。
- 星球相對於地球的直徑。
- 星球相對於地球的自轉頻率。
- 星球是否有環(TRUE或FALSE)。

經過在維基百科[Wikipedia](http://en.wikipedia.org/wiki/Planet)上的精密研究以後，你很有自信地建立了這些向量： `name` 、 `type` 、 `diameter` 、 `rotation` 與 `rings`，建立這些向量的程式碼已經寫好在編輯區中。

使用[`data.frame()`](http://www.rdocumentation.org/packages/base/functions/data.frame)函數建立資料框，這些向量都會成為資料框中的欄位，它們的長度都相同，但是資料格式有所不同。

*** =instructions
使用[`data.frame()`](http://www.rdocumentation.org/packages/base/functions/data.frame)函數建立資料框，將`name` 、 `type` 、 `diameter` 、 `rotation` 與 `rings` 做為參數放入 `data.frame()`並將建立的資料框命名為 `planets_df`。

*** =hint
你的`data.frame()`函數會長得類似像這樣：
```
data.frame(planets, type, diameter)
```
你可以完成它嗎？

*** =pre_exercise_code
```{r}
# no pec
```

*** =sample_code
```{r}
# 宣告向量
name <- c("Mercury", "Venus", "Earth", "Mars", "Jupiter", "Saturn", "Uranus", "Neptune")
type <- c("Terrestrial planet", "Terrestrial planet", "Terrestrial planet", 
          "Terrestrial planet", "Gas giant", "Gas giant", "Gas giant", "Gas giant")
diameter <- c(0.382, 0.949, 1, 0.532, 11.209, 9.449, 4.007, 3.883)
rotation <- c(58.64, -243.02, 1, 1.03, 0.41, 0.43, -0.72, 0.67)
rings <- c(FALSE, FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE)

# 由這些向量建立資料框
planets_df <-

```

*** =solution
```{r}
# 宣告向量
name <- c("Mercury", "Venus", "Earth", "Mars", "Jupiter", "Saturn", "Uranus", "Neptune")
type <- c("Terrestrial planet", "Terrestrial planet", "Terrestrial planet", 
          "Terrestrial planet", "Gas giant", "Gas giant", "Gas giant", "Gas giant")
diameter <- c(0.382, 0.949, 1, 0.532, 11.209, 9.449, 4.007, 3.883)
rotation <- c(58.64, -243.02, 1, 1.03, 0.41, 0.43, -0.72, 0.67)
rings <- c(FALSE, FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE)

# 由這些向量建立資料框
planets_df <- data.frame(name, type, diameter, rotation, rings)
```

*** =sct
```{r}
msg = "不需要更改向量的宣告，加入 `data.frame()` 建立 `planets_df`。"
test_object("name", undefined_msg = msg, incorrect_msg = msg)
test_object("type", undefined_msg = msg, incorrect_msg = msg)
test_object("diameter", undefined_msg = msg, incorrect_msg = msg)
test_object("rotation", undefined_msg = msg, incorrect_msg = msg)
test_object("rings", undefined_msg = msg, incorrect_msg = msg)

test_object("planets_df",
            incorrect_msg = "確認是否有使用 `data.frame()` 建立 `planets_df`，並確認在 `data.frame()` 函數中用正確的順序將所有的向量當作參數寫入： `name` 、 `type` 、 `diameter` 、 `rotation` 與 `rings`。")

success_msg("做得好，前進下一個練習，階下來我們要檢視你剛建立好的資料框！");
```


--- type:NormalExercise xp:100 skills:1 key:72d24b916b842527b40bd19ff3093b823980c234
## 建立一個資料框 (2)

`planets_df` 資料框已經載入至工作區，它有8個觀測值與5個欄位，你可以直接使用它。

*** =instructions
使用[`str()`](http://www.rdocumentation.org/packages/utils/functions/str)函數來檢視 `planets_df` 的結構與變數。

*** =hint
`planets_df` 已經載入至工作區，直接於編輯區輸入 `str(planets_df)` 即可。

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
```

*** =sample_code
```{r}
# 檢查planets_df的結構
```

*** =solution
```{r}
# 檢查planets_df的結構
str(planets_df)
```

*** =sct
```{r}
msg = "不需要移除或覆寫已經載入至工作區的 `planets_df` 資料框！"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_output_contains("str(planets_df)", incorrect_msg = "確認是否有使用 `str()` 來顯示 `planets_df` 的結構？")
success_msg("太棒了，你現在對 `planets_df` 有清楚的了解，接下來的練習將讓你學會如何從資料框中選擇元素！")
```


--- type:NormalExercise xp:100 skills:1 key:a6eeec0beaa5b270c1e9fd1fd4bf285ac5363e1a
## 從資料框中選擇元素

與向量及矩陣相似，你可以使用中括號 `[ ]` 從資料框中選擇，並用逗號分別指定要選擇的列與欄，例如：

- `my_df[1,2]` 將 `my_df` 第一列第二欄的元素選出。
- `my_df[1:3,2:4]` 將 `my_df` 第一到三列與第二至四欄選出。

有時候你想要選擇整列或整欄的所有元素，例如使用 `my_df[1, ]` 可以將第一列所有的元素選出，接下來我們將對 `planets_df` 練習這些技巧！

*** =instructions
- 從 `planets_df` 的第一列第三欄將水星的直徑選出，並印出結果。
- 從 `planets_df` 的第四列將火星所有的資訊選出，並印出結果。

*** =hint
利用 `planets_df[2,3]` 可以將金星的直徑選出，如果是水星呢？

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
```

*** =sample_code
```{r}
# planets_df資料框已經預先載入

# 印出水星的直徑(第一列第三欄)


# 印出火星的資訊(第四列)

```

*** =solution
```{r}
# planets_df資料框已經預先載入

# 印出水星的直徑(第一列第三欄)

# 印出火星的資訊(第四列)
planets_df[4, ]
```

*** =sct
```{r}
msg = "不需要更改或覆寫 `planets_df` 資料框。"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_output_contains("planets_df[1,3]", incorrect_msg = "確認你是否有利用 `[1,3]` 選擇並印出水星的直徑？")
test_output_contains("planets_df[4, ]", incorrect_msg = "確認你是否有利用 `[4,]` 選擇並印出火星的所有資訊？")
success_msg("太棒了，除了用索引值以外，你也可以用欄位名稱從資料框中選出元素，前進下一個練習！")
```


--- type:NormalExercise xp:100 skills:1 key:1b1be7e1473994d9d6762816f15ea282787be250
## 從資料框中選擇元素 (2)

除了使用索引值從資料框中選擇元素，你也可以使用變數名稱進行選擇。 

如果你想選擇 `type` 欄位的前三個元素，你可以這樣做

```
planets_df[1:3,1]
```

這個做法有一個缺點就是你必須要去查詢 `type` 在第幾欄，當你的變數變多時，這個做法就會變得很困難，因此用變數名稱就會顯得比較輕鬆：

```
planets_df[1:3,"type"]
```

*** =instructions
從 `planets_df` 中選擇並印出 `"diameter"` 的前5個值。

*** =hint
你可以使用 `planets_df[1:5, ...]` 選出前5個值，將 `...` 替換成 `"diameter"` 這個欄位。

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
```

*** =sample_code
```{r}
# planets_df資料框已經預先載入

# 選出diameter欄位的前5個值

```

*** =solution
```{r}
# planets_df資料框已經預先載入

# 選出diameter欄位的前5個值
planets_df[1:5, "diameter"]
```

*** =sct
```{r}
msg = "不需要移除或覆寫 `planets_df` 資料框。"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_output_contains("planets_df[1:5, \"diameter\"]", incorrect_msg = "確認是否有利用 `[1:5, \"diameter\"]` 選出直徑欄位的前5個數值並印出來？")
success_msg("太好了，前進下一個練習！")
```


--- type:NormalExercise xp:100 skills:1 key:c332cd7e7e46daa391edea8aea961414c8c8d0ce
## 有環的星球

你常常需要選出資料框中的某個特定欄位，假如要選出 `diameter` 變數，用以下兩列指令都可以：

```
planets_df[,3]
planets_df[,"diameter"]
```

其實還有使用 `$` 符號的簡便方法：

```
planets_df$diameter
```

*** =instructions
- 使用 `$` 符號把變數 `rings` 從 `planets_df` 選擇出來並指派給 `rings_vector`。
- 印出 `rings_vector` 看看有沒有做對。

*** =hint
使用 `planets_df$diameter` 可以將 `diameter` 欄位從 `planets_df` 中選出，那麼應該如何將 `rings` 欄位選出呢？

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
```

*** =sample_code
```{r}
# planets_df資料框已經預先載入

# 從planets_df選出變數rings 
rings_vector <- 
  
# 印出rings_vector
```

*** =solution
```{r}
# planets_df資料框已經預先載入

# 從planets_df選出變數rings
rings_vector <- planets_df$rings

# 印出rings_vector
rings_vector
```

*** =sct
```{r}
msg = "不需要更改或覆寫 `planets_df` 資料框。"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_object("rings_vector",
            incorrect_msg = "確認是否利用 `$rings` 將變數 `rings` 從 `planets_df` 中選出並指派給 `rings_vector`。")
test_output_contains("rings_vector", incorrect_msg = "別忘了在建立向量後將 `rings_vector` 印出！")
success_msg("太好了，前進下一個練習並學習另外一個選擇元素的方式！")
```


--- type:NormalExercise xp:100 skills:1 key:0aa1fd7d080afe1bb1031562e8004121943632c6
## 有環的星球 (2)

回憶一下高中教材你可能想起太陽系中有些行星有環而有些沒有，但你大概記不起他們的名稱，更別說他們的自轉頻率...等。

R可以幫助你辦到嗎？

在R Console輸入 `rings_vector` 你可以得到：

```
[1] FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE
```

這個結果表示前四個觀測值(或星球)沒有環(`FALSE`)，但另外四個有環(`TRUE`)，讓我們利用 `rings_vector` 將有環的四個星球選出來。 

*** =instructions
右方編輯區的程式將有環的星球名稱選出，修改程式改為將有環的星球_所有_欄位都選出。

*** =hint
記得利用 `[rings_vector, ]` 選出_所有_欄位，將欄位的部分留白就可以。

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
rings_vector <- planets_df$rings
```

*** =sample_code
```{r}
# planets_df與rings_vector已經預先載入

# 修改程式選擇有環星球的所有欄位
planets_df[rings_vector, "name"]
```

*** =solution
```{r}
# planets_df與rings_vector已經預先載入

# 修改程式選擇有環星球的所有欄位
planets_df[rings_vector, ]
```

*** =sct
```{r}
msg <- "不需要移除或覆寫 `planets_df` 或 `rings_vector`。"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_object("rings_vector", undefined_msg = msg, incorrect_msg = msg)
test_output_contains('planets_df[rings_vector, ]', incorrect_msg = "確認是否有使用 `planets_df[rings_vector, ]` 選出有環星球的_所有_欄位？逗號很重要，不要忘記了！")
success_msg("太棒了，這個解法有點麻煩，下一個練習會教你一個更簡潔的方式！")
```


--- type:NormalExercise xp:100 skills:1 key:9b873ed27e9df18a217699041950ecd20691eaf1
## 有環的星球但簡單些

想想在前一個練習中學會了什麼？你根據有環或者沒有環從 `planets_df` 中選出了資料框子集，這真的超強的，也許美國太空總署已經在偷偷討論要招募你了喔！

讓我們來認識一個更高明的[`subset()`](http://www.rdocumentation.org/packages/base/functions/subset)函數，[`subset()`](http://www.rdocumentation.org/packages/base/functions/subset)函數可以更快速地做到前面練習所做到的事情。

```
subset(my_df, subset = some_condition)
``` 

[`subset()`](http://www.rdocumentation.org/packages/base/functions/subset)函數中的第一個參數指定了要被篩選的資料，第二個參數則要告訴R篩選的邏輯為何。 

以下的程式會得到跟前一個練習一樣的結果，但這次你不需要另外宣告 `rings_vector`。

```
subset(planets_df, subset = rings)
``` 

*** =instructions
對 `planets_df` 使用 `subset()` 將直徑比地球小的星球選出來，由於直徑其實是個相對量值，你的條件應該要下 `diameter < 1`。

*** =hint
稍微修改一下 `subset(planets_df, subset = ...)` 將 `...` 改為？

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
```

*** =sample_code
```{r}
# planets_df資料框已經預先載入

# 選出直徑<1的星球

```

*** =solution
```{r}
# planets_df資料框已經預先載入

# 選出直徑<1的星球
subset(planets_df, subset = diameter < 1)
```

*** =sct
```{r}
msg = "不需要移除或覆寫 `planets_df` 資料框。"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_correct({
  test_output_contains("subset(planets_df, subset = diameter < 1)", incorrect_msg = "確認是否有在 `subset()` 函數中正確指派參數 `subset = ...`。條件應該要下 `diameter < 1` 並將結果印出。")  
}, {
  test_function("subset", args = "x", 
                not_called_msg = "確認是否有使用 `subset()` 函數？",
                incorrect_msg = " `subset()` 函數中的第一個參數應該為 `planets_df`。")
})
success_msg("太棒了， `subset()` 不僅很簡潔，它也能夠讓讀者更了解你的程式，前進下一個練習！");
```


--- type:NormalExercise xp:100 skills:1 key:2397d0f7cdf728961c9f5b8208c3b2694e20e2df
## 排序

Making and creating rankings is one of mankind's favorite affairs. These rankings can be useful (best universities in the world), entertaining (most influential movie stars) or pointless (best 007 look-a-like).

In data analysis you can sort your data according to a certain variable in the data set. In R, this is done with the help of the function [`order()`](http://www.rdocumentation.org/packages/base/functions/order). 

[`order()`](http://www.rdocumentation.org/packages/base/functions/order) is a function that gives you the ranked position of each element when it is applied on a variable, such as a vector for example:

```
> a <- c(100, 10, 1000)
> order(a)
[1] 2 1 3
```

10, which is the second element in `a`, is the smallest elements, so 2 comes first in the output of `order(a)`. 100, which is the first element in `a` is the second smallest element, so 1 comes second in the output of `order(a)`.

This means we can use the output of `order(a)` to reshuffle `a`:
    
```
> a[order(a)]
[1]   10  100 1000
``` 

*** =instructions
Experiment with the [`order()`](http://www.rdocumentation.org/packages/base/functions/order) function in the console. Click 'Submit Answer' when you are ready to continue.

*** =hint
Just play with the [`order()`](http://www.rdocumentation.org/packages/base/functions/order) function in the console!

*** =pre_exercise_code
```{r}
# no pec
```

*** =sample_code
```{r}
# Play around with the order function in the console
```

*** =solution
```{r}
# Play around with the order function in the console
```

*** =sct
```{r}
success_msg("Great! Now let's use the `order()` function to sort your data frame!")
```


--- type:NormalExercise xp:100 skills:1 key:81baabbbb256ac67de6d584ee37cfa218566f54a
## Sorting your data frame

Alright, now that you understand the [`order()`](http://www.rdocumentation.org/packages/base/functions/order) function, let us do something useful with it. You would like to rearrange your data frame such that it starts with the smallest planet and ends with the largest one. A sort on the `diameter` column.

*** =instructions
- Call `order()` on `planets_df$diameter` (the `diameter` column of `planets_df`). Store the result as `positions`.
- Now reshuffle `planets_df` with the `positions` vector as row indexes inside square brackets. Keep all columns. Simply print out the result.

*** =hint
- Use `order(planets_df$diameter)` to create `positions`.
- Now, you can use `positions` inside square brackets: `planets_df[...]`; can you fill in the `...`?

*** =pre_exercise_code
```{r}
load(url("http://s3.amazonaws.com/assets.datacamp.com/course/intro_to_r/planets.RData"))
```

*** =sample_code
```{r}
# planets_df is pre-loaded in your workspace

# Use order() to create positions
positions <-  

# Use positions to sort planets_df

```

*** =solution
```{r}
# planets_df is pre-loaded in your workspace

# Use order() to create positions
positions <- order(planets_df$diameter)

# Use positions to sort planets_df
planets_df[positions, ]
```

*** =sct
```{r}
msg = "Do not remove or overwrite the `planets_df` data frame!"
test_object("planets_df", undefined_msg = msg, incorrect_msg = msg)
test_object("positions",
            incorrect_msg = "Have you correctly calculated the `positions` variable? You can use `sort(planets_df$diameter)`.")
test_output_contains("planets_df[positions,]",
                     incorrect_msg = "Use `planets_df[positions, ]` to sort `planets_df`; the comma inside the square brackets is crucial!")
success_msg("Wonderful! This exercise concludes the chapter on data frames. Remember that data frames are extremely important in R, you will need them all the time. Another very often used data structure is the list. This will be the subject of the next chapter!")
```


